<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>D‚ÄôVetro ¬∑ Cat√°logo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --principal:#8B5E3C;
  --secundario:#B08968;
  --fondo:#FAF7F4;
  --texto:#3A2E2A;
  --verde:#25D366;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family:Arial,sans-serif;
  background:var(--fondo);
  color:var(--texto);

  min-height:100vh;          /* üëà ocupa toda la pantalla */
  display:flex;              /* üëà flex vertical */
  flex-direction:column;
}
/* ===== HEADER ===== */
header{
  background:linear-gradient(135deg,var(--principal),var(--secundario));
}
header img{width:100%;display:block}
header p{
  margin:0;
  padding:10px;
  text-align:center;
  color:#fff;
  font-size:14px;
}

/* ===== GRID RESPONSIVE REAL ===== */
.container{
  padding:15px;
  display:grid;
  grid-template-columns:repeat(auto-fit, minmax(230px, 1fr));
  gap:14px;
}
.producto{
  background:#fff;
  border-radius:16px;
  padding:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.1);
  position:relative; /* üëà CLAVE */
}
#productos{
  scroll-margin-top: 160px;
}

/* ===== GALERIA ===== */
.galeria{
  position:relative;
  overflow:hidden;
  border-radius:12px;
  margin-bottom:8px;
}
.galeria-track{
  display:flex;
  transition:transform .3s ease;
}
.galeria-track img{
  width:100%;
  flex-shrink:0;
  border-radius:12px;
  cursor:zoom-in;
}
.flecha{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  width:30px;height:30px;
  border-radius:50%;
  background:rgba(0,0,0,.4);
  color:#fff;
  border:none;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:20px;
  cursor:pointer;
}
.flecha.izq{left:6px}
.flecha.der{right:6px}

/* ===== INFO ===== */
h2{color:var(--principal);margin:6px 0}
.codigo{font-size:13px;color:#777}
.precio{
  display:inline-block;
  margin-top:6px;
  padding:6px 10px;
  background:rgba(139,94,60,.1);
  border-radius:8px;
  font-weight:bold;
}

select,button,input{
  width:100%;
  margin-top:8px;
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

button{
  background:linear-gradient(135deg,var(--principal),var(--secundario));
  color:#fff;
  font-weight:bold;
  border:none;
  cursor:pointer;
}

/* ===== DETALLES ===== */
.detalles{
  margin-top:10px;
  padding:10px;
  background:#f6f2ee;
  border-radius:10px;
  font-size:14px;
}
.detalles strong{color:var(--principal)}
.detalles ul{margin:6px 0 0;padding-left:18px}

/* ===== BARRA ===== */
#barra{
  position:fixed;
  bottom:0;left:0;
  width:100%;
  background:linear-gradient(135deg,var(--principal),var(--secundario));
  color:#fff;
  padding:12px;
  display:none;
  justify-content:center;
  font-weight:bold;
  cursor:pointer;
  z-index:1000;
}

/* ===== CARRITO ===== */
#carrito{
  position:fixed;
  top:0;right:0;
  width:90%;max-width:380px;
  height:100vh;
  background:#fff;
  box-shadow:-8px 0 24px rgba(0,0,0,.25);
  transform:translateX(100%);
  transition:.35s ease;
  padding:15px;
  z-index:1001;
  overflow:auto;
}
#carrito.abierto{transform:translateX(0)}

#lista{list-style:none;padding:0}
.controles{display:flex;gap:6px;margin-top:6px}
.controles button{
  width:32px;height:32px;border-radius:50%;
  border:none;font-weight:bold;font-size:16px;
}
.sumar{background:#e8f5ee;color:#1e7f4f}
.restar{background:#fbeaea;color:#a33}
.borrar{background:#eee;color:#555}

/* ===== DIRECCION ===== */
.direccion{
  margin-top:14px;
  padding:12px;
  background:#f6f2ee;
  border-radius:14px;
}
.direccion h4{margin:0 0 8px;color:var(--principal)}
.ayuda{font-size:12px;color:#777}

/* ===== WHATSAPP ===== */
.whatsapp{
  background:linear-gradient(135deg,#1ebe5d,#25D366);
  color:#fff;
  padding:14px;
  text-align:center;
  border-radius:10px;
  margin-top:10px;
  font-weight:bold;
  cursor:pointer;
}

/* ===== ZOOM ===== */
#zoomOverlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.9);
  display:none;
  justify-content:center;
  align-items:center;
  z-index:2000;
}
#zoomOverlay img{max-width:100%;max-height:98vh;border-radius:8px}

/* ===== FILTROS ===== */
.filtros{
  display:flex;
  gap:8px;
  padding:12px 15px 0;
}

.filtros button{
  flex:1;
  padding:8px;
  border-radius:20px;
  font-size:14px;
  background:#fff;
  color:var(--principal);
  border:1px solid rgba(139,94,60,.3);
}

.filtros button.activo{
  background:linear-gradient(135deg,var(--principal),var(--secundario));
  color:#fff;
}

/* ===== MENU CATEGORIAS ===== */
.menu-categorias{
  display:flex;
  gap:10px;
  padding:12px 15px;
  overflow-x:auto;
}

.menu-categorias::-webkit-scrollbar{
  display:none;
}

.menu-categorias button{
  padding:8px 16px;
  border-radius:999px;
  border:1px solid rgba(139,94,60,.25);
  background:#fff;
  color:var(--principal);
  font-size:14px;
  font-weight:500;
  white-space:nowrap;
  transition:.25s ease;
}

.menu-categorias button.activo{
  background:linear-gradient(135deg,var(--principal),var(--secundario));
  color:#fff;
  border-color:transparent;
}

/* ===== MENU DESPLEGABLE ===== */
.menu{
  padding:12px 15px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.menu button.simple{
  background:linear-gradient(135deg,var(--principal),var(--secundario));
  color:#fff;
  border-radius:999px;
  padding:10px;
}

/* ===== DETALLES DESPLEGABLES ===== */
.detalles{
  margin-top:10px;
  background:#f6f2ee;
  border-radius:10px;
  padding:8px 10px;
}

.detalles summary{
  cursor:pointer;
  font-weight:600;
  color:var(--principal);
  list-style:none;
}

.detalles summary::-webkit-details-marker{
  display:none;
}

.detalles ul{
  margin:8px 0 0;
  padding-left:18px;
  font-size:14px;
}

/* ===== BADGES ===== */
.badge{
  position:absolute;          /* üëà NO ocupa espacio */
  top:10px;
  left:10px;
  font-size:12px;
  padding:4px 8px;
  border-radius:999px;
  z-index:10;
}

.badge.destacado{
  background:#f5c542;
  color:#3a2e2a;
}

/* ===== PRODUCTO AGOTADO ===== */
.producto.agotado{
  opacity:0.75;
}

.producto.agotado::after{
  content:"AGOTADO";
  position:absolute;
  top:10px;
  right:10px;
  background:#a33;
  color:#fff;
  font-size:12px;
  padding:4px 10px;
  border-radius:999px;
  font-weight:bold;
  z-index:15;
}

/* ===== FAVORITOS ‚Äì CENTRADO PERFECTO ===== */
.fav-btn{
  position:absolute;
  top:10px;
  right:10px;
  width:36px;
  height:36px;
  border-radius:50%;
  border:none;
  background:#fff;

  display:flex;                 /* üëà CLAVE */
  align-items:center;           /* üëà CLAVE */
  justify-content:center;       /* üëà CLAVE */

  font-size:18px;               /* tama√±o real del coraz√≥n */
  line-height:1;                /* üëà evita corrimientos */
  padding:0;

  cursor:pointer;
  z-index:30;
  box-shadow:0 2px 6px rgba(0,0,0,.25);
}

.fav-btn.activo{
  background:#e63946;
  color:#fff;
}

/* ===== CONTADOR FAVORITOS ===== */
#contador-favoritos{
  position:sticky;
  top:0;
  z-index:900;
  background:#fff;
  padding:10px 15px;
  font-weight:bold;
  color:#e63946;
  box-shadow:0 2px 6px rgba(0,0,0,.1);
}

/* ===== MENU MEJOR DISTRIBUIDO ===== */
.menu{
  padding:12px 15px;
  display:flex;
  flex-direction:column;
  gap:16px;
}

/* grupo de categor√≠as */
.menu-grupo{
  display:grid;
  gap:12px;
}

/* acciones (destacados, ofertas, favoritos) */
.menu-acciones{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}

.menu-acciones button{
  flex:1;
  border-radius:999px;
}

@media(min-width:900px){
  .menu{
    flex-direction:row;
    align-items:flex-start;
  }

  .menu-grupo{
    flex:3;
    grid-template-columns:repeat(3, 1fr);
  }

  .menu-acciones{
    flex:1;
    flex-direction:column;
  }
}


/* ===== BOTONES DESTACADOS (ACCIONES) ===== */
.menu-acciones button{
  border-radius:999px;
  padding:12px 18px;
  font-size:15px;
  font-weight:bold;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:6px;

  background:#fff;
  color:var(--principal);
  border:2px solid rgba(139,94,60,.3);
  transition:all .25s ease;
}

/* hover */
.menu-acciones button:hover{
  transform:translateY(-1px);
  box-shadow:0 4px 10px rgba(0,0,0,.15);
}

/* ‚≠ê destacados */
.menu-acciones button:nth-child(1){
  background:linear-gradient(135deg,#f5c542,#f7a928);
  color:#3A2E2A;
  border:none;
}

/* üî• ofertas */
.menu-acciones button:nth-child(2){
  background:linear-gradient(135deg,#e63946,#f3626c);
  color:#fff;
  border:none;
}

/* ‚ù§Ô∏è favoritos */
.menu-acciones button:nth-child(3){
  background:linear-gradient(135deg,#ff6b6b,#f0cdd0);
 color:#3A2E2A;
  border:none;
}
/* ===== MENU ACORDEON PROPIO ===== */
.menu-item{
  background:#fff;
  border-radius:14px;
  box-shadow:0 2px 6px rgba(0,0,0,.08);
  overflow:hidden;
}

.menu-title{
  width:100%;
  padding:12px 14px;
  background:none;
  border:none;
  font-weight:600;
  color:var(--principal);
  text-align:left;
  cursor:pointer;
}

.menu-content{
  display:none;
  padding:10px 14px;
}

.menu-content button{
  margin-top:6px;
  background:#f6f2ee;
  color:var(--texto);
  border:1px solid rgba(0,0,0,.08);
  width:100%;
}

.menu-item.activo .menu-content{
  display:block;
}

/* ===== FORZAR MENU IGUAL EN PC Y MOBILE (OVERRIDE FINAL) ===== */
.menu{
  display:flex !important;
  flex-direction:column !important;
  gap:16px !important;
}

.menu-item{
  width:100% !important;
}

.menu-acciones{
  display:flex !important;
  flex-direction:column !important;
  gap:10px !important;
}

.menu-acciones button{
  width:100% !important;
}

/* ===== FOOTER NEGRO TOTAL ===== */
.footer{
  background:#000;            /* negro absoluto */
  color:#f1f1f1;
  padding:28px 16px;
  margin-top:40px;
}

.footer-contenido{
  max-width:1200px;
  margin:auto;
  text-align:center;
}

.footer-titulo{
  font-weight:bold;
  color:#f5c542;
  margin-bottom:14px;
  letter-spacing:.5px;
}

.footer-pagos{
  display:flex;
  justify-content:center;
  gap:16px;
  flex-wrap:wrap;
  font-size:14px;
  margin-bottom:16px;
}

.footer-pagos span{
  background:transparent;     /* üëà SIN cajas */
  border:none;
  padding:0;
  color:#f1f1f1;
}

.footer-copy{
  font-size:12px;
  color:#aaa;
}


/*---------------------------------------------*/

main{
  flex:1; /* üëà empuja el footer hacia abajo */
}

/*---------------------------------------------*/
.badge.oferta{
  background:#e63946;
  color:#fff;
  font-weight:bold;
}


</style>
</head>
<body>
<header>
<img src="https://res.cloudinary.com/dpxwplees/image/upload/v1769278270/logo2DVETRO_fbtgu1.jpg">
<p>Cristaler√≠a y bazar ¬∑ Env√≠os sin cargo en Montevideo</p>
<div id="contador-favoritos">
  ‚ù§Ô∏è <span id="fav-count">0</span> favoritos
</div>
</header>
<main>
<nav class="menu">

  <div class="menu-item">
    <button class="menu-title" onclick="toggleMenu(this)">üç≥ Art√≠culos de cocina</button>
    <div class="menu-content">
      <button onclick="filtrarCategoria('cocina')">Todos</button>
      <button onclick="filtrarSub('cocina','bowls')">Bowls</button>
      <button onclick="filtrarSub('cocina','fuentes')">Fuentes</button>
      <button onclick="filtrarSub('cocina','asaderas')">Asaderas</button>
      <button onclick="filtrarSub('cocina','platos')">Platos</button>
    </div>
  </div>

  <div class="menu-item">
    <button class="menu-title" onclick="toggleMenu(this)">ü•Ç Cristaler√≠a</button>
    <div class="menu-content">
      <button onclick="filtrarCategoria('cristaleria')">Todos</button>
      <button onclick="filtrarSub('cristaleria','vasos')">Vasos</button>
      <button onclick="filtrarSub('cristaleria','copas')">Copas</button>
      <button onclick="filtrarSub('cristaleria','jaras')">Jaras</button>
    </div>
  </div>

  <div class="menu-item">
    <button class="menu-title" onclick="toggleMenu(this)">üî• Parrilla</button>
    <div class="menu-content">
      <button onclick="filtrarCategoria('parrilla')">Todos</button>
      <button onclick="filtrarSub('parrilla','tablas')">Tablas</button>
      <button onclick="filtrarSub('parrilla','accesorios')">Accesorios</button>
    </div>
  </div>

  <div class="menu-acciones">
    <button onclick="filtrarTag('destacado')">‚≠ê Destacados</button>
    <button onclick="filtrarTag('oferta')">üî• Ofertas</button>
    <button class="simple" onclick="filtrarFavoritos()">‚ù§Ô∏è Favoritos</button>
  </div>

</nav>
<!-------------------------------------------------------------------PRODUCTOS---------------------------------------------------------------------------------------------->

<div class="container" id="productos">
</div>

<!---------------------------------------------------------------- FIN PRODUCTOS ------------------------------------------------------------------------------------------->
<!-- CARRITO -->
<div id="carrito">
<button onclick="toggle()">‚Üê Seguir buscando</button>

<ul id="lista"></ul>
<strong id="total"></strong>

<div class="direccion">
<h4>üßæ Datos para la entrega</h4>
<input id="nombre" placeholder="Pedido a nombre de">
<input id="calle" placeholder="Calle">
<input id="numero" placeholder="N√∫mero (o Manzana / Solar)">
<div class="ayuda">Ej: Manzana 78 Solar 07 ‚Üí escribir 7807</div>
</div>

<div class="whatsapp" onclick="enviar()">Enviar pedido a D'vetro</div>
</div>
<div id="barra" onclick="toggle()">
<span id="resumen">üõí Mi pedido</span>
</div>
<div id="zoomOverlay" onclick="cerrarZoom()">
<img id="zoomImg" onclick="event.stopPropagation()">
</div>
<script>

/* === PRODUCTOS AGOTADOS === */
/*ahi dejo comentado como seleccionar por su codigo el producto agotado*/
const codigosAgotados = [
  /*'NF7664X24',
  'NF7664X24',
  'NF7664X24'*/
];
/* === FIN PRODUCTOS AGOTADOS === */

function marcarProductosAgotados(){
  document.querySelectorAll('.producto').forEach(prod=>{
    const codigoTxt = prod.querySelector('.codigo')?.textContent || '';

    codigosAgotados.forEach(cod=>{
      if(codigoTxt.includes(cod)){
        // marcar estado
        prod.classList.add('agotado');
        prod.setAttribute('data-tags','agotado');

        // desactivar botones
        prod.querySelectorAll('button').forEach(b=>{
          if(!b.classList.contains('flecha')){
            b.disabled = true;
            b.style.opacity = '0.5';
            b.style.cursor = 'not-allowed';
          }
        });
      }
    });
  });
}



let pedido={};

/* === CARRITO === */
function agregar(codigo,nombre,base,pack){
  pack=parseInt(pack);
  if(!pack) return alert("Eleg√≠ un pack");

  let ajuste=pack==2?.12:pack==4?.05:pack==12?-.04:pack==24?-.08:0;
  let precioPack=Math.round((base/6)*pack*(1+ajuste));
  let clave=codigo+"_x"+pack;

  if(!pedido[clave]){
    pedido[clave]={codigo,nombre,pack,precioPack,cantidad:0};
  }
  pedido[clave].cantidad++;
  render();
}

function render(){
  const lista=document.getElementById("lista");
  const barra=document.getElementById("barra");
  const resumen=document.getElementById("resumen");
  const totalEl=document.getElementById("total");

  lista.innerHTML="";
  let total=0,items=0;

  for(let k in pedido){
    let p=pedido[k];
    let sub=p.precioPack*p.cantidad;
    total+=sub; items+=p.cantidad;

    lista.innerHTML+=`
      <li>
        <strong>${p.nombre}</strong><br>
        Pack x${p.pack} ¬∑ Cantidad ${p.cantidad}<br>
        Subtotal $${sub}
        <div class="controles">
          <button class="sumar" onclick="pedido['${k}'].cantidad++;render()">+</button>
          <button class="restar" onclick="pedido['${k}'].cantidad--;if(pedido['${k}'].cantidad<=0)delete pedido['${k}'];render()">‚àí</button>
          <button class="borrar" onclick="delete pedido['${k}'];render()">üóëÔ∏è</button>
        </div>
      </li>`;
  }

  if(total>0){
    barra.style.display="flex";
    resumen.textContent=`üõí ${items} producto(s) ‚Äî $${total}`;
    totalEl.textContent="Total: $"+total;
  }else{
    barra.style.display="none";
    document.getElementById("carrito").classList.remove("abierto");
  }

  localStorage.setItem("pedidoDvetro",JSON.stringify(pedido));
}

function toggle(){
  document.getElementById("carrito").classList.toggle("abierto");
}

function enviar(){
  if(!Object.keys(pedido).length) return alert("Pedido vac√≠o");

  let nombre = document.getElementById("nombre").value;
  let calle = document.getElementById("calle").value;
  let numero = document.getElementById("numero").value;
  if(!nombre || !calle || !numero) return alert("Complet√° los datos");

  let msg = `- Pedido D‚ÄôVetro%0A- ${nombre}%0A%0A`;
  let total = 0;

  for(let k in pedido){
    let p = pedido[k];
    let sub = p.precioPack * p.cantidad;
    total += sub;

    let tipo =
      p.pack === "Unidad"
        ? "Unidad"
        : `Pack x${p.pack}`;

    msg += `- ${p.nombre}%0A`;
    msg += `  C√≥digo: ${p.codigo}%0A`;
    msg += `  ${tipo} ¬∑ Cantidad: ${p.cantidad}%0A`;
    msg += `  $${sub}%0A%0A`;
  }

  msg += `- Total: $${total}%0A- ${calle} ${numero}`;
  window.open("https://wa.me/59895770717?text=" + msg, "_blank");

  // üßπ LIMPIAR CARRITO
  pedido = {};
  document.getElementById("lista").innerHTML = "";
  document.getElementById("total").innerHTML = "";

  // üßº LIMPIAR DATOS DE ENTREGA
  document.getElementById("nombre").value = "";
  document.getElementById("calle").value = "";
  document.getElementById("numero").value = "";

  // üõí RESET TEXTO DEL BOT√ìN
  document.getElementById("resumen").innerText = "üõí Mi pedido";

  // cerrar carrito
  toggle();
}


/* === GALERIA / ZOOM === */
function mover(b,d){
  let g=b.parentElement,q=g.querySelector(".galeria-track");
  let i=g.dataset.i||0;
  i=(+i+d+q.children.length)%q.children.length;
  g.dataset.i=i;
  q.style.transform=`translateX(-${i*100}%)`;
}

function zoom(s){
  zoomImg.src=s;
  zoomOverlay.style.display="flex";
}

function cerrarZoom(){zoomOverlay.style.display="none"}

function agregarUnidad(codigo, nombre, precioUnitario){
  const clave = codigo + "_unidad";

  if(!pedido[clave]){
    pedido[clave] = {
      codigo,
      nombre,
      pack: "Unidad",
      precioPack: precioUnitario,
      cantidad: 0
    };
  }

  pedido[clave].cantidad++;
  render();
}

function ocultarFlechasSiUnaImagen(){
  document.querySelectorAll(".galeria").forEach(galeria=>{
    const imgs = galeria.querySelectorAll(".galeria-track img");
    const flechas = galeria.querySelectorAll(".flecha");

    if(imgs.length <= 1){
      flechas.forEach(f => f.style.display = "none");
    }
  });
}

function actualizarPrecioUnidad(codigo, precioBase, pack){
  let ajuste = 0;

  if(pack === 1 || pack === 2) ajuste = 0.12;
  else if(pack === 4) ajuste = 0.05;
  else if(pack === 6) ajuste = 0;
  else if(pack === 12) ajuste = -0.04;
  else if(pack === 24) ajuste = -0.08;

  const precioUnidad = Math.round((precioBase / 6) * (1 + ajuste));

  const el = document.getElementById("precio-unidad-" + codigo);
  if(el){
    el.textContent = "$" + precioUnidad + " por unidad";
  }
}

/* === FILTRO POR CATEGORIA === */

function scrollAProductos(){
  const cont = document.getElementById("productos");
  if(cont){
    cont.scrollIntoView({
      behavior: "smooth",
      block: "start"
    });
  }
}

function filtrarCategoria(cat){
  document.querySelectorAll(".producto").forEach(p=>{
    p.style.display =
      (cat === "todos" || p.dataset.categoria === cat)
      ? "block" : "none";
  });

  scrollAProductos();
}

function filtrarSub(cat, sub){
  document.querySelectorAll(".producto").forEach(p=>{
    p.style.display =
      (p.dataset.categoria === cat && p.dataset.sub === sub)
      ? "block" : "none";
  });

  scrollAProductos();
}

function filtrarTag(tag){
  document.querySelectorAll(".producto").forEach(p=>{
    const tags = p.dataset.tags || "";
    p.style.display = tags.includes(tag) ? "block" : "none";
  });

  scrollAProductos();
}

/* === FAVORITOS === */
let favoritos = JSON.parse(localStorage.getItem('favoritosDvetro')) || [];

function toggleFavorito(btn){
  const prod = btn.closest('.producto');
  const codigoTxt = prod.querySelector('.codigo')?.textContent || '';
  const codigo = codigoTxt.replace('C√≥digo:','').trim();

  if(favoritos.includes(codigo)){
    favoritos = favoritos.filter(c => c !== codigo);
    btn.classList.remove('activo');
    btn.textContent = 'ü§ç';
  }else{
    favoritos.push(codigo);
    btn.classList.add('activo');
    btn.textContent = '‚ù§Ô∏è';
  }

  localStorage.setItem('favoritosDvetro', JSON.stringify(favoritos));
  actualizarContadorFavoritos();

}

function filtrarFavoritos(){
  document.querySelectorAll('.producto').forEach(prod=>{
    const codigoTxt = prod.querySelector('.codigo')?.textContent || '';
    const codigo = codigoTxt.replace('C√≥digo:','').trim();

    prod.style.display = favoritos.includes(codigo)
      ? 'block'
      : 'none';
  });

  scrollAProductos();
}

function actualizarContadorFavoritos(){
  const cont = document.getElementById('contador-favoritos');
  const count = favoritos.length;

  if(count === 0){
    cont.style.display = 'none';
  }else{
    cont.style.display = 'block';
    document.getElementById('fav-count').textContent = count;
  }
}


/* ===============================
   CARGA DE PRODUCTOS DESDE JSON
================================ */

fetch("productos.json")
  .then(r => r.json())
  .then(data => {
    data.forEach(p => crearProducto(p));
    ocultarFlechasSiUnaImagen();
    marcarProductosAgotados();
    restaurarFavoritos();
  });

function crearProducto(p){
  const cont = document.getElementById("productos");
  const tags = (p.tags || []).join(" ");

  cont.insertAdjacentHTML("beforeend", `
    <div class="producto"
      data-categoria="${p.categoria}"
      data-sub="${p.subcategoria}"
      data-tags="${tags}">

      ${p.tags?.includes("destacado")
        ? `<span class="badge destacado">‚≠ê Destacado</span>`
        : ""}

      <button class="fav-btn" onclick="toggleFavorito(this)">ü§ç</button>

      ${crearGaleria(p.imagenes)}

      <h2>${p.nombre}</h2>
      <div class="codigo">C√≥digo: ${p.codigo}</div>

      ${p.tipoVenta === "pack"
        ? crearVentaPack(p)
        : crearVentaUnidad(p)}

      <details class="detalles">
        <summary>üìê Ver detalles</summary>
        <ul>
          ${p.detalles.map(d => `<li>${d}</li>`).join("")}
        </ul>
      </details>
    </div>
  `);
}

function crearGaleria(imgs){
  return `
    <div class="galeria">
      <button class="flecha izq" onclick="mover(this,-1)">‚Äπ</button>
      <div class="galeria-track">
        ${imgs.map(i =>
          `<img src="${i}" onclick="zoom('${i}')" loading="lazy">`
        ).join("")}
      </div>
      <button class="flecha der" onclick="mover(this,1)">‚Ä∫</button>
    </div>
  `;
}

function crearVentaPack(p){
  return `
    <select onchange="actualizarPrecioUnidad('${p.codigo}', ${p.precioBase}, parseInt(this.value) || 6)">
      <option value="">Eleg√≠ pack</option>
      ${p.packs.map(n => `<option value="${n}">x${n}</option>`).join("")}
    </select>

    <button onclick="agregar('${p.codigo}','${p.nombreCorto}',${p.precioBase}, this.previousElementSibling.value)">
      Agregar a mi pedido
    </button>

    <div class="precio" id="precio-unidad-${p.codigo}"></div>
  `;
}

function crearVentaUnidad(p){
  return `
    <button onclick="agregarUnidad('${p.codigo}','${p.nombreCorto}',${p.precioUnidad})">
      Agregar a mi pedido
    </button>

    <div class="precio">$${p.precioUnidad} por unidad</div>
  `;
}

function restaurarFavoritos(){
  document.querySelectorAll('.producto').forEach(prod=>{
    const codigo = prod.querySelector('.codigo')
      ?.textContent.replace('C√≥digo:','').trim();
    const btn = prod.querySelector('.fav-btn');

    if(favoritos.includes(codigo)){
      btn.classList.add('activo');
      btn.textContent = '‚ù§Ô∏è';
    }
  });
  actualizarContadorFavoritos();
}

/* === PERSISTENCIA === */
window.onload = () => {
  let data = localStorage.getItem("pedidoDvetro");
  if(data){
    pedido = JSON.parse(data);
    render();
  }

  ocultarFlechasSiUnaImagen(); // üëà ESTO

// üëá precio por unidad por defecto (x6)
  actualizarPrecioUnidad('NF7764X24', 490, 2);
  actualizarPrecioUnidad('NF7664X24', 580, 2);


  marcarProductosAgotados();
  

/* restaurar favoritos */
document.querySelectorAll('.producto').forEach(prod=>{
  const codigoTxt = prod.querySelector('.codigo')?.textContent || '';
  const codigo = codigoTxt.replace('C√≥digo:','').trim();
  const btn = prod.querySelector('.fav-btn');

  if(favoritos.includes(codigo) && btn){
    btn.classList.add('activo');
    btn.textContent = '‚ù§Ô∏è';
  }
});
};

document.querySelector(".menu-acciones button:nth-child(1)")
  ?.classList.add("activo");

function toggleMenu(btn){
  const item = btn.closest('.menu-item');

  document.querySelectorAll('.menu-item').forEach(i=>{
    if(i !== item) i.classList.remove('activo');
  });

  item.classList.toggle('activo');
}



/* === MENU ACORDEON LIMPIO === */
document.querySelectorAll('.menu details').forEach(detalle=>{
  detalle.addEventListener('toggle', ()=>{
    if(detalle.open){
      document.querySelectorAll('.menu details').forEach(otro=>{
        if(otro !== detalle){
          otro.removeAttribute('open');
        }
      });
    }
  });
});

</script>
</main>
<footer class="footer">
  <div class="footer-contenido">
    <p class="footer-titulo">Medios de pago</p>

    <div class="footer-pagos">
      <span>üí≥ Mercado Pago</span>
      <span>üè¶ Transferencia bancaria</span>
      <span>üí≥ Prex</span>
      <span>üè™ Red Pagos</span>
      <span>üíµ Efectivo</span>
    </div>

    <p class="footer-copy">
      ¬© D‚ÄôVetro ¬∑ Cristaler√≠a y bazar ¬∑ Montevideo ¬∑ +598-95770717
    </p>
  </div>
</footer>

</body>
</html>
